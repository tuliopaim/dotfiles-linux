---
- name: Setup APT repositories
  block:

    - name: Install Microsoft apt repository key
      apt_key:
        url: https://packages.microsoft.com/keys/microsoft.asc
        state: present
      become: yes

    - name: Download packages-microsoft-prod.deb
      get_url:
        url: "https://packages.microsoft.com/config/ubuntu/21.04/packages-microsoft-prod.deb"
        dest: "/tmp/packages-microsoft-prod.deb"

    - name: Install packages-microsoft-prod.deb
      become: yes
      apt:
       deb: "/tmp/packages-microsoft-prod.deb"
       state: present

    - name: Remove packages-microsoft-prod.deb
      file:
        path: "/tmp/packages-microsoft-prod.deb"
        state: absent
